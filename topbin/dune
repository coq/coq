(library
 (name rocqshim)
 (public_name coq-core.rocqshim)
 (modules rocqshim)
 (wrapped false) ; no point repeating the rocqshim name
 (synopsis "Rocq shim for dynlinked subcommands"))

(library
 (name rocqloader)
 (public_name coq-core.rocqloader)
 (synopsis "Rocq support for finding and dynlinking subcommands")
 (wrapped false) ; no point repeating the Rocqloader name
 (modules rocqloader)
 (libraries boot unix threads findlib.dynload rocqshim))

(executable
 (public_name rocq)
 (package coq-core)
 (modules rocq)
 (modes exe byte)
 (libraries rocqloader))

(install
 (section bin)
 (package coq-core)
 (files (rocq.bc as rocq.byte)))

(executable
 (name coqtop_bin)
 (public_name coqtop)
 (package coq-core)
 (modules coqtop_bin)
 (libraries coq-core.toplevel))

(executable
 (name coqtop_byte_bin)
 (public_name coqtop.byte)
 (package coq-core)
 (modules coqtop_byte_bin)
 (libraries compiler-libs.toplevel coq-core.config.byte coq-core.toplevel coq-core.dev findlib.top)
 (modes byte))

(executable
 (name coqc_bin)
 (public_name coqc)
 (package coq-core)
 (modules coqc_bin)
 (libraries rocqloader))

(executable
 (name coqnative_bin)
 (public_name coqnative)
 (package coq-core)
 (modules coqnative_bin)
 (libraries coq-core.kernel)
 (modes exe byte)
 (link_flags -linkall))

(library
 (name rocqworker_lib)
 (public_name coq-core.rocqworker)
 (modules rocqworker_lib)
 (libraries coq-core.toplevel rocqshim))

; Workers
(executable
 (name coqworker_bin)
 (modules coqworker_bin)
 (modes exe byte)
 (libraries rocqloader))
 ; Adding -ccopt -flto to links options could be interesting, however,
 ; it doesn't work on Windows

(install
 (section libexec)
 (package coq-core)
 (files
  (coqworker_bin.exe as coqworker)
  (coqworker_bin.bc as coqworker.byte)))
