(rule
 (targets sphinx_build)
 (deps
  ; We could use finer dependencies here so the build is faster:
  ;
  ; - vo files: generated by sphinx after parsing the doc, promoted,
  ; - Static files:
  ;   + %{bin:coqdoc} etc...
  ;   + config/coq_config.py
  ;   + tools/coqdoc/coqdoc.css
  (package coq)
  (source_tree sphinx)
  (source_tree tools)
  (env_var SPHINXWARNOPT))
 (action
  (run env COQLIB=%{project_root} sphinx-build -j4 %{env:SPHINXWARNOPT=-W} -b html -d sphinx_build/doctrees sphinx sphinx_build/html)))

(include refman-install.inc)

(rule
 (targets refman-install.gen)
 (action
  (with-stdout-to %{targets}
    (run %{project_root}/tools/gen_install.exe coq-refman doc sphinx_build/html refman/html))))

(alias
 (name refman-html)
 (action
  (diff refman-install.inc refman-install.gen)))

(alias
 (name refman-html)
 (deps sphinx_build))

; The install target still needs more work.
; (install
;  (section doc)
;  (package coq-refman)
;  (files sphinx_build))
